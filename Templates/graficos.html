<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 0;
            color: #333;
        }

        /* Header com Bot칚o de Voltar */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: #102770;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .voltar-btn {
            text-decoration: none;
            color: #fff;
            font-size: 1.5rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            display: flex;
            align-items: center;
            transition: background-color 0.3s, color 0.3s;
        }

        .voltar-btn:hover {
            background-color: #4BC0C0;
            color: #fff;
        }

        .voltar-btn i {
            margin-right: 0.5rem;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            color: #0A58CAFF;
            margin-top: 100px; /* Ajuste para o header fixo */
        }

        .dashboard {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 40px;
            max-width: 1200px;
            margin: 30px auto;
            padding-top: 80px; /* Espa칞o para o header fixo */
        }

        .chart-container {
            background: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0px 6px 18px rgba(0, 0, 0, 0.1);
            width: 380px;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1s ease-out, transform 1s ease-out;
            transition-delay: 0.2s;
        }

        .chart-container h2 {
            font-size: 1.6rem;
            margin-bottom: 15px;
            color: #0A58CAFF;
        }

        .chart-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .no-data {
            font-size: 1.2rem;
            color: #e74c3c;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>

    <!-- Header com Bot칚o de Voltar -->
    <div class="header">
        <a href="{{ url_for('telaInicialGerente') if session['user_type'] == 'gerente' else (url_for('telaInicialProfessor') if session['user_type'] == 'professor' else url_for('telaInicialAluno')) }}" class="voltar-btn">
            <i class="bi bi-arrow-left-circle"></i>
        </a>
    </div>

    <h1>Dashboard de Dados</h1>

    <div class="dashboard">
        <div class="chart-container" id="chart1">
            <h2>Total de Chaves</h2>
            <div id="totalChavesChart"></div>
        </div>

        <div class="chart-container" id="chart2">
            <h2>Usu치rios por Categoria</h2>
            <div id="usuariosChart"></div>
        </div>

        <div class="chart-container" id="chart3">
            <h2>Chaves Mais Acessadas</h2>
            <div id="chavesChart"></div>
        </div>
    </div>

    <script>
        async function carregarGraficos() {
            const resposta = await fetch('http://127.0.0.1:5000/api/dados-graficos');
            const dados = await resposta.json();
            console.log(dados);

            function mostrarComDelay(elemento, tempo) {
                setTimeout(() => {
                    elemento.classList.add("show");
                }, tempo);
            }

            // Paleta de cores moderna
            const cores = ['#36A2EB', '#4BC0C0', '#FF9F40', '#9966FF', '#FF6384'];

            // 游늷 Gr치fico 1: Total de Chaves
            const totalChavesOptions = {
                series: [{
                    name: "Quantidade",
                    data: [dados.total_chaves]
                }],
                chart: {
                    type: 'bar',
                    height: 300,
                    animations: {
                        enabled: true,
                        easing: 'easeOutBounce',
                        speed: 1000
                    }
                },
                plotOptions: {
                    bar: {
                        borderRadius: 10,
                        horizontal: false,
                        distributed: true
                    }
                },
                colors: [cores[0]],
                xaxis: {
                    categories: ['Total de Chaves'],
                    labels: {
                        style: {
                            fontSize: '14px',
                            fontWeight: 600
                        }
                    }
                },
                yaxis: {
                    labels: {
                        style: {
                            fontSize: '14px',
                            fontWeight: 600
                        }
                    }
                },
                tooltip: {
                    theme: 'dark',
                    style: {
                        fontSize: '14px'
                    }
                }
            };

            const totalChavesChart = new ApexCharts(document.querySelector("#totalChavesChart"), totalChavesOptions);
            totalChavesChart.render();

            mostrarComDelay(document.getElementById("chart1"), 200);

            // 游늷 Gr치fico 2: Usu치rios por Categoria
            const usuariosOptions = {
                series: dados.usuarios.valores,
                chart: {
                    type: 'donut',
                    height: 300,
                    animations: {
                        enabled: true,
                        easing: 'easeOutQuart',
                        speed: 1200
                    }
                },
                labels: dados.usuarios.categorias,
                colors: cores,
                legend: {
                    position: 'bottom',
                    fontSize: '14px',
                    fontWeight: 600
                },
                tooltip: {
                    theme: 'dark',
                    style: {
                        fontSize: '14px'
                    }
                }
            };

            const usuariosChart = new ApexCharts(document.querySelector("#usuariosChart"), usuariosOptions);
            usuariosChart.render();

            mostrarComDelay(document.getElementById("chart2"), 400);

            // 游늷 Gr치fico 3: Chaves Mais Acessadas
            if (dados.chaves_acessadas && dados.chaves_acessadas.nome.length > 0) {
                const chavesOptions = {
                    series: [{
                        name: 'Acessos',
                        data: dados.chaves_acessadas.quantidades
                    }],
                    chart: {
                        type: 'bar',
                        height: 300,
                        animations: {
                            enabled: true,
                            easing: 'easeOutCubic',
                            speed: 1500
                        }
                    },
                    plotOptions: {
                        bar: {
                            borderRadius: 10,
                            horizontal: false,
                            distributed: true
                        }
                    },
                    colors: [cores[3]],
                    xaxis: {
                        categories: dados.chaves_acessadas.nome,
                        labels: {
                            style: {
                                fontSize: '14px',
                                fontWeight: 600
                            }
                        }
                    },
                    yaxis: {
                        labels: {
                            style: {
                                fontSize: '14px',
                                fontWeight: 600
                            }
                        }
                    },
                    tooltip: {
                        theme: 'dark',
                        style: {
                            fontSize: '14px'
                        }
                    }
                };

                const chavesChart = new ApexCharts(document.querySelector("#chavesChart"), chavesOptions);
                chavesChart.render();
            } else {
                document.getElementById("chavesChart").innerHTML = "<div class='no-data'>Sem dados dispon칤veis</div>";
            }

            mostrarComDelay(document.getElementById("chart3"), 600);
        }

        carregarGraficos();
    </script>

</body>
</html>